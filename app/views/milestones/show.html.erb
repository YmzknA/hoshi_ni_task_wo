<div class="h-full w-full">
  <!-- 月の画像 -->
  <%= render 'title_header', title: @title %>

  <!-- 内容表示部分 -->
  <div class="relative z-10 min-h-screen space-y-5 rounded-t-[4rem] border-x-1 border-t-1 border-base-200 bg-base-300/30 p-8 text-center text-lg md:text-xl">

    <!-- フラッシュメッセージ -->
    <div id="flash" class="fixed m-5 top-0 left-0 right-0 z-50">
      <%= render 'flash' %>
    </div>

    <div class="flex items-center justify-center text-3xl">
      <div class="mr-2">
        <%= render "stars_icon", { width: 35, height: 35, color: @milestone.color } %>
      </div>
      <%= @milestone.title %>
    </div>

    <div class="flex items-center justify-center text-2xl">
      <div class="my-10 h-12 w-xl rounded-full bg-primary px-5 text-xl text-neutral">
        <%= render "milestone_completed_percent_bar", milestone: @milestone, milestone_tasks: @milestone_tasks %>
      </div>
    </div>

    <% if @milestone.start_date.present? || @milestone.end_date.present? %>
      <div class="flex h-35 w-full justify-center text-neutral">
        <div class="flex w-xl justify-between p-3">
          <div class="card flex h-full w-2/5 flex-col justify-center bg-primary p-2">
            <div>
              <%= @milestone.start_date&.year %>年
            </div>
            <div class="w-full text-xl">
              <%= to_short_date(@milestone.start_date) %>
            </div>
          </div>
          <div class="flex w-1/5 items-center justify-center">
            <p class="w-full text-5xl text-primary">~</p>
          </div>
          <div class="card flex h-full w-2/5 flex-col justify-center bg-primary p-2">
            <%= @milestone.end_date&.year %>年<br>
            <div class="w-full text-xl">
              <%= to_short_date(@milestone.end_date) %>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <div class="flex w-full justify-center">
        <div class="card w-xl bg-primary p-10 text-neutral">
          日付は設定されていません
        </div>
      </div>
    <% end %>

    <div class="flex w-full items-center justify-center">
      <div class="card w-xl text-neutral">
        <% unless @milestone.description == "" || @milestone.description.blank? %>
          <p class="card-title h-5 pl-2 text-primary">詳細</p>
          <div class="flex min-h-[100px] w-full items-center justify-center rounded-xl bg-primary p-3">
            <%= @milestone.description %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="mb-8 flex h-[100px] items-center justify-center">
      <div class="flex h-full w-xl">
        <div class="flex w-3/4 items-center justify-center rounded-xl md:bg-base-300/40 text-base-200">
          <div>
            <div class="mb-3 flex items-center justify-end">
              <div class="mr-2 text-center">
                全体に公開する：
              </div>
              <% if @milestone.is_public %>
                <span class="badge badge-md badge-primary md:badge-lg">ON</span>
              <% else %>
                <span class="badge badge-md badge-base-300 md:badge-lg">OFF</span>
              <% end %>
            </div>

            <div class="flex items-center">
              <div class="mr-2 text-center">
                チャートに表示する：
              </div>
              <% if @milestone.is_on_chart %>
                <span class="badge badge-md badge-primary md:badge-lg">ON</span>
              <% else %>
                <span class="badge badge-md badge-base-300 md:badge-lg">OFF</span>
              <% end %>
            </div>
          </div>
        </div>

        <div class="flex h-full w-1/4 items-center justify-center">
          <button class="btn btn-neutral rounded-lg px-3">
            <%= image_tag 'x-logo.png', class: 'h-6 w-6' %>
          </button>
        </div>
      </div>
    </div>


    <% if current_user?(@milestone.user) %>
      <div class="flex h-12 w-full justify-center text-neutral">
        <div class="btn btn-error mr-5 h-12 w-25 md:w-42">
          削除
        </div>
        <button class="btn btn-accent h-12 w-25 md:w-42" onclick="milestone_edit_modal.showModal()">
          編集
        </button>
      </div>
    <% end %>

    <!-- タスクの表示部分 -->
    <div class="flex w-full items-center justify-center mb-10">
    <div class="tabs tabs-lift w-xl">
      <!-- チャート -->
      <input type="radio" name="my_tabs" class="tab" aria-label="チャート" checked="checked"  />
      <div class="tab-content border-base-300 bg-base-100 p-6">
        <div class="overflow-x-auto">
          test
        </div>
      </div>

      <!-- タスク -->
      <input type="radio" name="my_tabs" class="tab" aria-label="タスク" />
      <div class="tab-content border-base-300 bg-base-100 p-3">

        <% if current_user?(@milestone.user) %>
          <!-- 新規作成ボタン -->
          <div class="card flex items-center justify-center mb-4 size-full h-25 bg-base-300/40 shadow-xl/10">
            <%= link_to new_task_path(milestone_from_milestone_show: @milestone), class: "size-full p-1 rounded-xl hover:cursor-pointer hover:bg-base-300/30 p-4", data: { turbo_frame: "tasks_new_modal"} do %>
              <div class="flex items-center justify-center size-full">
                <span class="material-symbols-outlined">
                  add_circle
                </span>
                追加
              </div>
            <% end %>
          </div>
        <% end %>

        <!-- タスク一覧 -->
        <%= render "tasks/tasks", tasks: @milestone_tasks %>

        </div>
    </div>

  </div>
  </div>

  <!-- メニューバー -->
  <div class="mt-10">
    <%= render 'menu_bar' %>
  </div>
</div>

<% if current_user?(@milestone.user) %>
  <%= render 'milestones/milestone_edit_form', milestone: @milestone %>
  <%= turbo_frame_tag "tasks_edit_modal" %>
  <%= turbo_frame_tag "tasks_new_modal" %>
<% end %>

<%= turbo_frame_tag "tasks_show_modal" %>

